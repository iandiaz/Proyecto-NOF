<%@page import="VO.UbicacionVO"%>
<%@page import="VO.EstructuraCobroVO"%>
<%@page import="VO.AnexoContratoVO"%>
<%@page import="java.util.ArrayList"%>
<% 	

String modname=(String)request.getAttribute("modname");
String contrato_id=(String)request.getAttribute("contrato_id");
String cliente_firma=(String)request.getAttribute("cliente_firma");
String cliente_rut=(String)request.getAttribute("cliente_rut");
String CONT_NOMBRE=(String)request.getAttribute("CONT_NOMBRE");
String contrato_fecha_firma=(String)request.getAttribute("contrato_fecha_firma");
ArrayList<String> ubicaciones=(ArrayList<String>)request.getAttribute("ubicaciones");

String Usu_nom=(String)request.getAttribute("usuname");	

String fecha=(String)request.getAttribute("fecha");

AnexoContratoVO anexoContrato=(AnexoContratoVO)request.getAttribute("anexoContrato");

ArrayList<String> tipocambios = (ArrayList<String>)request.getAttribute("tipocambios");
	
    %>
<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <title>New Office</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
   
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.css">
   <link rel="stylesheet" type="text/css" href="stylesheets/theme.css">
   <link rel="stylesheet" type="text/css" href="stylesheets/butons.css">
   <link rel="stylesheet" type="text/css" href="stylesheets/inputs.css">
    <link rel="stylesheet" href="lib/font-awesome/css/font-awesome.css">

    <script src="lib/jquery-1.7.2.min.js" type="text/javascript"></script>
    

    <!-- Demo page code -->

    <style type="text/css">
        #line-chart {
            height:300px;
            width:800px;
            margin: 0px auto;
            margin-top: 1em;
        }
        .brand { font-family: georgia, serif; }
        .brand .first {
            color: #ccc;
            font-style: italic;
        }
        .brand .second {
            color: #fff;
            font-weight: bold;
        }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
 
 <style type="text/css">
        #line-chart {
            height:300px;
            width:800px;
            margin: 0px auto;
            margin-top: 1em;
        }
       
        .amarillo{
			border-color: #FFFF00;
			background-color: #FFFF00;
		}
		.amarillo:focus{
		border-color: #F4FA58;
		box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 6px #F0EC33;
		}
        .brand { font-family: georgia, serif; }
        .brand .first {
            color: #ccc;
            font-style: italic;
        }
        .brand .second {
            color: #fff;
            font-weight: bold;
        }
		table{
			font-size:20px;
			}
	tbody {
	  
	    height: 120px;
	    overflow-y: scroll;
	}
	thead, tbody {
		 min-width:100%;
    	display: inline-block;
    	
	}
		select{
			
				}
				
	.click:hover{
		opacity:0.5;
		cursor: pointer;
	}
		
	@media screen and (min-width: 700px) {
	.cuadroblanco{
			box-shadow:0px 2px 5px 0px rgba(50, 50, 50, 0.75);
			border: 1px solid black;
			min-height:100%; height:330px;  
		min-width: 350px;
			max-width:1000px;
position: relative;
background:#CCC;
margin: 0 auto;
		}
		.inputMovil{
			width:100%;
		}

	}
	@media screen and (max-width: 699px) {
		.cuadroblanco{
			min-width:100%; 
			 height:100px; min-height:250px;width:350px;
			background:#FFF;
			position: relative;

		}
		.inputMovil{
			width:100%;
		}
		.content{
			min-width: 1px;
			}

	}
    </style>
    
    
    <script type="text/javascript">
      
    function validateNum(event) {
        var key = window.event ? event.keyCode : event.which;
		//alert(event.keyCode);
        if (event.keyCode == 8 || event.keyCode == 46
         || event.keyCode == 37 || event.keyCode == 39 || event.keyCode == 9 || event.keyCode == 190 || (key >= 96 && key <= 105)) {
            return true;
        }
        else if ( key < 48 || key > 57 ) {
            return false;
        }
        else return true;
    };
    
    var submitting;
    function disableSubmitB(){
    	//submitting=true;
    	$(".divload").show();
    	$(".divgrabar").hide();
    	//document.getElementById('grabar').disabled = true;
    	document.getElementById('grabar').value = "ESPERA";
    	
    	
    	
    }
	function enableSubmitB(){
		submitting=false;
    	$(".divload").hide();
    	$(".divgrabar").show();
    	//document.getElementById('grabar').disabled = false;
    	document.getElementById('grabar').value = "GRABAR";
    	
    	
    }
	
    function validateSubmit(){
    	
    	var validate= true;
    	var msg="ERRORES: \n";
    	

    	if(document.getElementById('cargoFijoUnico').value==""){
    		msg+="DEBE INGRESAR UN CARGO FIJO UNICO\n";
    		validate=false;
    	}
    	if(document.getElementById('observacion').value==""){
    		msg+="DEBE INGRESAR UNA OBSERVACION\n";
    		validate=false;
    	}
    	
    	if($('.dale:checked').length==0){
    		msg+="DEBE SELECCIONAR AL MENOS 1 UBICACION\n";
    		validate=false;
    	}
    	
    	
    	<%
    	if(anexoContrato.getEstructurasCobro().size()==0){ %>
			msg+="DEBE INGRESAR ESTRUCTURAS DE COBRO\n";
			validate=false;

    	<% }
    	%>
    	        	
    	if(validate){
    		if(submitting){
    			alert("INFORMACION YA ENVIADA");
    		}else{
    			disableSubmitB();
            	
        		return true;
    			//return false;
    		}
    		
    	}
    	else{
    		enableSubmitB();
    		alert(msg);
    		return false;
    	}
    	
    	
    }
    </script>
    
     <script>
   $(function(){
    $("#todos").click(function(e) {
     if($("#todos").attr('checked')){
                     $('.dale').attr('checked',true);
     }else{
      $('.dale').attr('checked',false);
     }
                });
   });
  </script>
  </head>

  <!--[if lt IE 7 ]> <body class="ie ie6"> <![endif]-->
  <!--[if IE 7 ]> <body class="ie ie7 "> <![endif]-->
  <!--[if IE 8 ]> <body class="ie ie8 "> <![endif]-->
  <!--[if IE 9 ]> <body class="ie ie9 "> <![endif]-->
  <!--[if (gt IE 9)|!(IE)]><!--> 
 
  
  <body class=""> 
  <!--<![endif]-->

    
<div class="navbar">
	<div class="brand">
	  <img src="lib/bootstrap/img/logonew_big.png">
	</div>
	<div class="version" align="right">
	  <p>N013.M.02.001</p>
	</div>
	<form method="get" action="" style="margin: 0px 0px 0px 0px;">       
		<button type="submit" name="logout" id="logout" class="btn btn-danger pull-right" style="margin-right: 5px; margin-top:5px;">CERRAR SESIÓN</button>
	</form>  
	<button type="button" class="btn btn-danger pull-right" style="margin-right: 5px; margin-top:5px;" onclick="location='/M01/'">VOLVER</button> 
	<div align="center" class="title">
		<p >MODIFICAR <%=modname %></p>
	</div>
</div>
<div class="content" >
  <form action="M02" name="form1" method="post"> 
    <input type="hidden" name="contrato_id" value="<%=contrato_id %>">
    
	<div class=" cuadroblanco" style="height:40px;padding: 5px 5px 5px 5px;">
		<div class="divhead"><strong>CORRELATIVO:</strong><input type="text" style="width:80px;height:30px ;background:#FFF;" name="gv_id" id="gv_id" value="${anexoContrato.getAnc_id()}" readonly="readonly"></div>
		<div class="divhead"><strong>FECHA:</strong><input type="text" style="width:130px;height:30px ;background:#FFF;" name="gv_fecha" id="gv_fecha" value="<%=fecha %>" readonly="readonly" ></div>
	</div>

	<div class=" cuadroblanco" style="height:200px;margin-top: 5px;">
		<h3 class="subtitle" align="center" style="margin:0px 0px 0px 0px"><p style="margin:0px 0px;font-size:20px;background-color: #39F">DATOS CLIENTE</p></h3>
		<div style="padding: 5px 5px 5px 5px">
		<div class="divhead"><strong>GRUPO:</strong><input type="text" value="${anexoContrato.getEmpresa().getGrupos_nombre()}" style="width:200px;height:30px ;background:#FFF;" readonly="readonly"></div> 
		<div class="divhead"><strong>EMPRESA:</strong><input type="text" value="${anexoContrato.getEmpresa().getEmpresas_nombrenof()}" style="width:500px;height:30px ;background:#FFF;" readonly="readonly"></div>		
		<div class="divhead"><strong>RAZON SOCIAL:</strong><input type="text" value="${anexoContrato.getEmpresa().getEmpresas_razonsocial()}" style="width:500px;height:30px ;background:#FFF;" readonly="readonly""></div>
		<div class="divhead"><strong>RUT:</strong><input type="text" value="${anexoContrato.getEmpresa().getEmpresas_rut()}" style="width:145px;height:30px ;background:#FFF;" disabled="disabled" ></div>
		<div class="divhead"><strong>FIRMANTE CLIENTE:</strong><input type="text" value="<%=cliente_firma %>" style="width:510px;height:30px ;background:#FFF;" disabled></div>
		<div class="divhead"><strong>RUT:</strong><input type="text" value="<%=cliente_rut %>" style="width:145px;height:30px ;background:#FFF;" disabled></div>
		<div class="divhead"><strong>CONTACTO:</strong><input type="text" value="<%=CONT_NOMBRE %>" style="width:500px;height:30px ;background:#FFF;" disabled></div>
		<div class="divhead"><strong>FECHA FIRMA:</strong><input type="text" value="<%=contrato_fecha_firma %>" style="width:130px;height:30px ;background:#FFF;" disabled></div>
		</div>
	</div>
	<table  class="table004det">
  <thead style="border-bottom: 1px solid black;background:#39F ;">
  <tr>
    <th scope="col" style="width: 50px;" >ID</th>
    <th scope="col" style="width: 12px"><input type="checkbox" id="todos" name="todos" value="1"></th>
    <th scope="col" style="width: 910px;" >UBICACION</th>
  </tr>
  </thead>
  <tbody class="scroll">
  
    <%
    String mod_actual="";
   	
        for(int i =0; i<ubicaciones.size(); i++){ 
        	 
        	 
        	String[] ubi = ubicaciones.get(i).split(";;");
        	
        	boolean selected=false;
        	
        	//verificamos si el anexo tiene la ubicacion seleccionada
        	for(UbicacionVO ubic : anexoContrato.getUbicaciones()){
        		if(ubic.getUbi_id().equals(ubi[0])){
        			selected=true;
        			break;
        		}
        	}
        	
        
        	 
  %>
  <tr>
    <td class="int" width="50px"><%=ubi[0]%></td>
    <td class="int" align="center"><input class="dale" name="ubicaciones[]"  value="<%=ubi[0]%>" type="checkbox" <%if(selected){%> checked="checked" <%} %>></td>
    <td class="int" width="910px"><%=ubi[1]%></td>
    
  </tr>
         
        <%  }
         
         %>
  </tbody>
</table> 
	
	<div class=" cuadroblanco" style="height:160px;margin-top: 5px;">
		<h3 class="subtitle" align="center" style="margin:0px 0px 0px 0px"><p style="margin:0px 0px;font-size:20px;background-color: #39F">DATOS DEL ANEXO</p></h3>
		<div style="padding: 5px 5px 5px 5px;">
		<div class="divhead"><strong>CARGO FIJO UNICO CONTRATO:</strong><input type="text" name="cargoFijoUnico" id="cargoFijoUnico" class="amarillo" style="width:130px;height:30px ;background:#FF3;" value="${anexoContrato.getCargoFijoUnico()}" onkeydown="return validateNum(event)" ></div>
		<div class="divhead"><strong>TIPO DE CAMBIO:</strong><select name="tipo_cambio_id">
    									<% for(String tipoCam:tipocambios){
    											String tipc_ar[]=tipoCam.split(";;");
    										%>
    										<option value="<%=tipc_ar[0] %>" <%if(tipc_ar[0].equals(anexoContrato.getTipoCambio_id())){%> selected="selected" <%} %> ><%=tipc_ar[1] %></option>	
    									<% } %>
    									
    								
    								</select></div>		
		<div class="divhead"><strong>OBSERVACION:</strong><input type="text" name="observacion" id="observacion" class="amarillo" maxlength="70" style="width:720px;height:30px ;background:#FF3;" value="${anexoContrato.getObservacion()}" ></div>
		</div>
		 
	</div>
	
	<table  class="table004det">
  <thead style="border-bottom: 1px solid black; background:#39F;">
  <tr>
    <th scope="col" style="width: 50px;" >ID</th>
   
    <th scope="col" style="width: 940px;" >ESTRUCTURA DE COBRO</th>
  </tr>
  </thead>
  <tbody class="scroll">
  <% for(EstructuraCobroVO estructura: anexoContrato.getEstructurasCobro()){
	  
	  %>
	<tr onclick="location='M03?estr=<%=estructura.getEstrcobro_id() %>'" class="click" >
    	<td class="int" width="50px"><%=estructura.getEstrcobro_id() %></td>
    	<td class="int" width="940px"><%=estructura.getEstrcobro_observaciones()%></td>
    	<td class="int" width="50px"><button type="submit" name="deteleEstructura" id="deteleEstructura" class="btn btn-success" value="<%=estructura.getEstrcobro_id() %>" ><i class="icon-remove"></i></button></td>
    
  	</tr>
  <% } %>
    
  
         
        
  </tbody>
</table> 

	<div class=" cuadroblanco divgrabar" style="height:45px;margin-top: 5px;">
		<div class="bgrabar">
		 <button type="submit" name="addestructura" id="addestructura" class="btn btn-success" >AGREGAR ESTRUCTURA</button>
          <button type="submit" name="grabar" id="grabar" class="btn btn-success" onclick="return validateSubmit()" >GRABAR</button>
       	</div> 
	</div>
	<div class=" cuadroblanco divload" style="height:45px;margin-top: 5px;display: none;">
		
       	<div class="bgrabar">
		 <button type="button" class="btn btn-success" >GRABANDO POR FAVOR ESPERA</button>
          
       	</div> 
	</div>
</form>
</div><br><br><br>
<div class="footerapp">               
	<p style="float: left;"><i class="icon-user"></i>	
	<strong><%=Usu_nom %></strong></p>
	<button type="button" onclick="window.open('/003/','_blank')" class="btn btn-danger pull-right" style="margin-right: 5px; margin-top:2px;">MENU</button>
</div>

    <script src="lib/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript">
        $("[rel=tooltip]").tooltip();
        $(function() {
            $('.demo-cancel-click').click(function(){return false;});
        });
    </script>
    
  </body>
</html>


